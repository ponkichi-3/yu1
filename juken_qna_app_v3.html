<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>中学受験 1問1答（記述＋ヒント＋復習）v3</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Hiragino Sans',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;overflow-x:hidden}
.container{background:#fff;border-radius:20px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,.1);max-width:820px;width:100%}
h1,h2{text-align:center;color:#333;margin-bottom:18px}
h1{font-size:26px}
.sub{font-size:13px;text-align:center;color:#718096;margin-bottom:18px}
.button{display:block;width:100%;padding:14px;margin-bottom:12px;border:none;border-radius:10px;font-size:18px;font-weight:700;cursor:pointer;transition:.2s;color:#fff;text-align:center;-webkit-appearance:none}
.button:hover{transform:translateY(-1px);box-shadow:0 5px 12px rgba(0,0,0,.2)}
.button-purple{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
.button-green{background:linear-gradient(135deg,#48bb78 0%,#2f855a 100%)}
.button-blue{background:linear-gradient(135deg,#3182ce 0%,#2c5282 100%)}
.button-gray{background:linear-gradient(135deg,#718096 0%,#4a5568 100%)}
.button-orange{background:linear-gradient(135deg,#ed8936 0%,#c05621 100%)}
.hidden{display:none !important}
.form-group{margin-bottom:14px}
label{display:block;margin-bottom:6px;font-weight:700;color:#4a5568;font-size:14px}
select,input[type=text],textarea{width:100%;padding:10px;border:2px solid #e2e8f0;border-radius:8px;font-size:16px;transition:border-color .2s}
select:focus,input[type=text]:focus,textarea:focus{outline:none;border-color:#667eea}
textarea{min-height:100px;resize:vertical}
.checkbox-group{max-height:240px;overflow-y:auto;border:2px solid #e2e8f0;border-radius:8px;padding:12px;background:#fff}
.select-controls{display:flex;gap:10px;margin:8px 0}
.select-button{padding:8px 16px;border:2px solid #667eea;border-radius:8px;background:#fff;color:#667eea;cursor:pointer;font-size:14px;font-weight:600;transition:.15s}
.select-button:hover{background:#667eea;color:#fff}
.progress-bar{height:8px;background:#e2e8f0;border-radius:4px;margin-bottom:12px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#667eea 0%,#48bb78 100%);transition:width .3s;border-radius:4px}
.timer{font-size:16px;color:#667eea;font-weight:700;text-align:center;margin-bottom:8px}
.quiz-container{text-align:left}
.question-box{background:#f8f9fa;border-radius:12px;padding:18px;margin-bottom:14px}
.question-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.question-number{font-size:14px;color:#718096;font-weight:600}
.point-badge{background:#667eea;color:#fff;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:700}
.question-title{font-size:13px;color:#4a5568;margin-bottom:6px;font-weight:600}
.question-text{font-size:20px;font-weight:700;color:#2d3748;line-height:1.5}
.user-answer-box{margin-top:12px}
.model-answer{margin-top:10px;padding:12px;background:#e6fffa;border:2px solid #38b2ac;border-radius:8px;display:none}
.model-answer-label{font-size:12px;color:#2c7a7b;font-weight:700;margin-bottom:4px}
.model-answer-text{color:#234e52;font-size:15px;line-height:1.5;white-space:pre-wrap}
.rate-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
.rate-btn{padding:10px;border:2px solid #e2e8f0;border-radius:10px;background:#fff;cursor:pointer;font-weight:700;transition:.15s}
.rate-btn.perfect{border-color:#48bb78}
.rate-btn.some{border-color:#ed8936}
.rate-btn.none{border-color:#f56565}
.rate-btn.selected{background:#f0f4ff;border-color:#667eea}
.rate-note{font-size:12px;color:#718096;text-align:center;margin-top:4px}
#rateFeedback{font-size:12px;color:#2c5282;text-align:center;margin-top:6px;display:none}
.hint-box{margin-top:10px;padding:12px;background:#fff7ed;border:2px solid #ed8936;border-radius:8px;display:none}
.hint-label{font-size:12px;color:#c05621;font-weight:700;margin-bottom:4px}
.hint-text{color:#7b341e;font-size:15px;line-height:1.5;white-space:pre-wrap}
.hint-btn{display:inline-block;padding:8px 12px;border:2px solid #ed8936;border-radius:8px;background:#fff;cursor:pointer;font-size:14px;font-weight:700;color:#c05621;margin-top:10px}
.result-details{background:#f7fafc;border-radius:12px;padding:16px;margin:14px 0}
.result-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #e2e8f0}
.result-item:last-child{border-bottom:none}
.score-display{font-size:56px;font-weight:800;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:10px 0;text-align:center}
.small{font-size:12px;color:#718096;text-align:center;margin-top:6px}
#err{display:none;margin-bottom:10px;padding:10px;border-radius:8px;background:#FED7D7;color:#822727;font-weight:700}
@media (max-width:480px){.rate-grid{grid-template-columns:1fr} .question-text{font-size:18px} .score-display{font-size:48px}}
</style>
</head>
<body>
<div class="container">
  <div id="err"></div>
  <div id="homeScreen">
    <h1>中学受験 1問1答（記述＋復習）</h1>
    <div class="sub">CSVはGitHubに配置（自動読込）。見つからない場合は東北・北海道のサンプル20問を使用。</div>
    <button class="button button-purple" onclick="startTestSetup('test')">テストモード</button>
    <button class="button button-orange" onclick="startTestSetup('practice')">練習モード</button>
    <button class="button button-green" onclick="startReviewMode()">復習モード</button>
    <div class="small">
      自動探索ファイル名: <code id="csvNameNote">juken_questions.csv</code>
    </div>
  </div>

  <div id="settingsScreen" class="hidden">
    <h2>設定</h2>

    <div class="form-group">
      <label>モード</label>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:10px">
        <div id="modeTest" class="select-button" style="text-align:center" onclick="selectMode('test')">テスト</div>
        <div id="modePractice" class="select-button" style="text-align:center" onclick="selectMode('practice')">練習</div>
      </div>
      <div class="sub" id="modeNote">記述式で入力 →「解答を確認」で模範解答表示 → 記憶度を3択で自己評価</div>
    </div>

    <div class="form-group">
      <label>科目（複数選択可）</label>
      <div class="select-controls">
        <button class="select-button" onclick="selectAllSubjects()">全て選択</button>
        <button class="select-button" onclick="deselectAllSubjects()">全て解除</button>
      </div>
      <div class="checkbox-group" id="subjectGroup"></div>
    </div>

    <div class="form-group">
      <label>出題順</label>
      <select id="questionOrder">
        <option value="sequential">順番通り</option>
        <option value="shuffle">シャッフル</option>
      </select>
    </div>

    <div class="form-group">
      <label>問題数</label>
      <select id="questionCount">
        <option value="5">5問</option>
        <option value="10" selected>10問</option>
        <option value="all">全問題</option>
      </select>
    </div>

    <div class="form-group" id="timeLimitGroup">
      <label>制限時間（テストのみ）</label>
      <select id="timeLimit">
        <option value="5">5分</option>
        <option value="10" selected>10分</option>
        <option value="15">15分</option>
        <option value="0">無制限</option>
      </select>
    </div>

    <button class="button button-blue" onclick="startQuiz()">開始</button>
    <button class="button button-gray" onclick="backToHome()">戻る</button>
  </div>

  <div id="quizScreen" class="hidden">
    <div id="timer" class="timer"></div>
    <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>

    <div class="quiz-container">
      <div class="question-box">
        <div class="question-header">
          <div id="questionNumber" class="question-number"></div>
          <div id="pointBadge" class="point-badge"></div>
        </div>
        <div id="questionTitle" class="question-title"></div>
        <div id="questionText" class="question-text"></div>

        <div class="user-answer-box">
          <label for="userAnswer">あなたの解答（記述）</label>
          <textarea id="userAnswer" placeholder="ここに解答を記述"></textarea>
        </div>
      </div>

      <div>
        <button id="confirmButton" class="button button-blue" onclick="confirmAnswer()">解答を確認</button>

        <div id="modelAnswer" class="model-answer">
          <div class="model-answer-label">模範解答</div>
          <div id="modelAnswerText" class="model-answer-text"></div>
        </div>

        <button id="hintButton" class="hint-btn" type="button" style="display:none" onclick="toggleHint()">ヒントを見る</button>
        <div id="hintBox" class="hint-box">
          <div class="hint-label">ヒント</div>
          <div id="hintText" class="hint-text"></div>
        </div>

        <div id="rateArea" class="hidden">
          <div class="rate-grid">
            <button id="btnPerfect" class="rate-btn perfect" onclick="rateCurrent('perfect')">完璧に覚えた</button>
            <button id="btnSome" class="rate-btn some" onclick="rateCurrent('some')">まだ完璧ではない</button>
            <button id="btnNone" class="rate-btn none" onclick="rateCurrent('none')">ぜんぜん覚えられていない</button>
          </div>
          <div id="rateFeedback">保存しました。</div>
          <div class="rate-note">※「まだ」「ぜんぜん」で復習リストに追加（ローカル保存）</div>
        </div>

        <button id="nextButton" class="button button-blue hidden" onclick="nextQuestion()">次の問題へ</button>
        <button id="finishButton" class="button button-orange hidden" onclick="finishQuiz()">終了</button>
      </div>
    </div>
  </div>

  <div id="resultScreen" class="hidden">
    <h2>終了</h2>
    <div id="scoreDisplay" class="score-display"></div>
    <div class="result-details">
      <div class="result-item"><span>問題数</span><span id="totalCount"></span></div>
      <div class="result-item"><span>所要時間</span><span id="elapsedTime"></span></div>
      <div class="result-item"><span>復習に追加</span><span id="reviewAddedCount"></span></div>
    </div>
    <div id="detailedResults"></div>
    <button class="button button-green" onclick="startReviewMode()">復習モードでやる</button>
    <button class="button button-gray" onclick="backToHome()">メニューに戻る</button>
  </div>
</div>

<script>
// ====== 基本設定 ======
const DEFAULT_CSVS = ['juken_questions.csv','questions.csv'];
document.getElementById('csvNameNote').textContent = DEFAULT_CSVS[0];

// エラーを画面に表示
window.addEventListener('error', (e)=>{
  const box=document.getElementById('err');
  box.textContent = 'スクリプトエラー: ' + (e.message||'') + '（詳細はブラウザのコンソールを参照）';
  box.style.display='block';
});

// ====== 状態 ======
let questionData = [];           // CSV/サンプル全件
let currentQuestions = [];       // 今回の出題リスト
let currentIndex = 0;
let startTime = null;
let timerInterval = null;
let timeLimit = 10;
let mode = 'test';
let reviewPool = [];
let reviewAddedNow = 0;
const REVIEW_KEY='jukenReviewPoolV3';

// ====== 画面制御 ======
function show(id){
  ['homeScreen','settingsScreen','quizScreen','resultScreen'].forEach(s=>{
    const el=document.getElementById(s); if(el) el.classList.add('hidden');
  });
  document.getElementById(id).classList.remove('hidden');
}
function backToHome(){
  resetState();
  show('homeScreen');
}
function startTestSetup(m){
  mode=m;
  show('settingsScreen');
  updateModeUI();
}

// ====== 初期化 ======
document.addEventListener('DOMContentLoaded', async ()=>{
  loadReviewPool();
  buildSubjectUI(); // 4科目チェックボックス
  await autoLoadCSVOrSample();
});

function updateModeUI(){
  document.getElementById('timeLimitGroup').style.display = (mode==='test') ? 'block':'none';
  document.getElementById('modeNote').textContent = '記述式で入力 →「解答を確認」で模範解答表示 → 記憶度を3択で自己評価';
}

function resetState(){
  currentQuestions=[]; currentIndex=0; startTime=null; reviewAddedNow=0;
  if(timerInterval) clearInterval(timerInterval);
  const ans=document.getElementById('userAnswer'); if(ans) ans.value='';
  document.getElementById('modelAnswer').style.display='none';
  document.getElementById('rateArea').classList.add('hidden');
  ['btnPerfect','btnSome','btnNone'].forEach(id=>{
    const b=document.getElementById(id); if(b){ b.classList.remove('selected'); b.disabled=false; }
  });
  const fb=document.getElementById('rateFeedback'); fb.style.display='none'; fb.textContent='保存しました。';
  document.getElementById('nextButton').classList.add('hidden');
  document.getElementById('finishButton').classList.add('hidden');
  document.getElementById('hintBox').style.display='none';
  document.getElementById('hintButton').style.display='none';
}

// ====== CSV 読み込み or サンプル ======
async function autoLoadCSVOrSample(){
  // まずCSVを試す
  for (const name of DEFAULT_CSVS){
    try{
      const res = await fetch(name, {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const text = await res.text();
      const rows = parseCSV(text);
      questionData = normalizeRows(rows);
      console.log(`[CSV] Loaded ${questionData.length} rows from ${name}`);
      document.getElementById('csvNameNote').textContent = name + '（読込）';
      deselectAllSubjects();
      return;
    }catch(e){
      console.warn(`[CSV] Failed to load ${name}`, e);
    }
  }
  // 見つからなければサンプルで初期化（社会 20問）
  questionData = SAMPLE_20.map(x=>({...x}));
  document.getElementById('csvNameNote').textContent = 'サンプル20問（社会）を使用中';
  deselectAllSubjects();
}

// シンプルCSVパーサ（ダブルクオート対応）
function parseCSV(text){
  const rows=[]; let row=[]; let cur=''; let inQ=false;
  for(let i=0;i<text.length;i++){
    const c=text[i], n=text[i+1];
    if(inQ){
      if(c==='\"'){
        if(n==='\"'){ cur+='\"'; i++; } else { inQ=false; }
      }else cur+=c;
    }else{
      if(c==='\"'){ inQ=true; }
      else if(c===','){ row.push(cur); cur=''; }
      else if(c==='\r'){ /* skip */ }
      else if(c==='\n'){ row.push(cur); rows.push(row); row=[]; cur=''; }
      else cur+=c;
    }
  }
  if(cur.length>0 || row.length>0){ row.push(cur); rows.push(row); }
  return rows;
}

function normalizeHeader(h){
  return (h||'').toString().trim().toLowerCase().replace(/[\s_]+/g,'');
}

// 期待ヘッダ: id,question,answer,hint,subject,point,title
function normalizeRows(rows){
  if(!rows || !rows.length) return [];
  const header = rows[0].map(normalizeHeader);
  const idx = (name)=> header.indexOf(normalizeHeader(name));

  const idI=idx('id'), qI=idx('question'), aI=idx('answer'), hI=idx('hint');
  const sI=idx('subject'), pI=idx('point'), tI=idx('title');

  const out=[];
  for(let i=1;i<rows.length;i++){
    const r=rows[i]; if(!r || r.length===0) continue;
    const get = (I)=> (I>=0 && I<r.length) ? (r[I]||'') : '';
    const subject = (get(sI)||'').trim() || 'その他';
    const title = (get(tI)||'').trim() || '未分類';
    out.push({
      id: (get(idI)||'').toString().trim(),
      question: (get(qI)||'').toString().trim(),
      answer: (get(aI)||'').toString().trim(),
      hint: (get(hI)||'').toString().trim(),
      subject,
      point: (get(pI)||'').toString().trim(),
      title
    });
  }
  return out.filter(q=>q.question && q.answer);
}

// ====== 科目UI ======
const SUBJECTS = ['算数','国語','理科','社会'];
function buildSubjectUI(){
  const box=document.getElementById('subjectGroup'); box.innerHTML='';
  SUBJECTS.forEach(sub=>{
    const label=document.createElement('label');
    label.style.display='flex';label.style.alignItems='center';label.style.padding='4px 0';label.style.cursor='pointer';label.style.fontSize='14px';
    label.innerHTML = `<input type="checkbox" value="${sub}" style="margin-right:8px"> ${sub}`;
    box.appendChild(label);
  });
}
function selectAllSubjects(){ document.querySelectorAll('#subjectGroup input[type=checkbox]').forEach(cb=>cb.checked=true); }
function deselectAllSubjects(){ document.querySelectorAll('#subjectGroup input[type=checkbox]').forEach(cb=>cb.checked=false); }

// ====== 復習リスト ======
function loadReviewPool(){ try{ reviewPool = JSON.parse(localStorage.getItem(REVIEW_KEY)||'[]'); if(!Array.isArray(reviewPool)) reviewPool=[]; } catch(_){ reviewPool=[]; } }
function saveReviewPool(){ localStorage.setItem(REVIEW_KEY, JSON.stringify(reviewPool)); }
function addToReview(q){
  if(!q || !q.id) return;
  if(!reviewPool.some(x=>String(x.id)===String(q.id))){
    reviewPool.push(q);
    saveReviewPool();
    reviewAddedNow++;
  }
}

// ====== 出題開始 ======
function selectMode(m){ mode=m; updateModeUI(); }
function startQuiz(){
  // 選択された科目
  const selected = [...document.querySelectorAll('#subjectGroup input[type=checkbox]:checked')].map(cb=>cb.value);
  if(selected.length===0){
    alert('科目を1つ以上選択してください'); return;
  }
  let filtered = questionData.filter(q=> selected.includes(q.subject) );
  if(!filtered.length){
    alert('選択した科目に該当する問題がありません。CSVの subject をご確認ください。');
    return;
  }

  const order=document.getElementById('questionOrder').value;
  if(order==='shuffle') filtered = shuffle(filtered);

  const count=document.getElementById('questionCount').value;
  if(count!=='all') filtered = filtered.slice(0, parseInt(count,10));

  currentQuestions = filtered.map(q=>({...q}));
  currentIndex=0; reviewAddedNow=0;

  if(mode==='test'){
    timeLimit=parseInt(document.getElementById('timeLimit').value||'10',10);
    startTime=Date.now();
    const update=()=>{
      const elapsed=Math.floor((Date.now()-startTime)/1000);
      const remaining=timeLimit*60 - elapsed;
      if(timeLimit>0){
        if(remaining<=0){ clearInterval(timerInterval); finishQuiz(); return; }
        const mm=String(Math.floor(remaining/60)).padStart(1,'0');
        const ss=String(remaining%60).padStart(2,'0');
        document.getElementById('timer').textContent = `残り時間: ${mm}:${ss}`;
      }else{ document.getElementById('timer').textContent=''; }
    };
    update(); timerInterval=setInterval(update,1000);
  }else{
    document.getElementById('timer').textContent='';
  }

  show('quizScreen');
  renderQuestion();
}

// ====== 出題表示 ======
function renderQuestion(){
  if(currentIndex>=currentQuestions.length){ finishQuiz(); return; }
  const q=currentQuestions[currentIndex];
  document.getElementById('questionNumber').textContent=`問${currentIndex+1} / ${currentQuestions.length}`;
  document.getElementById('pointBadge').textContent=q.point||q.subject||'';
  document.getElementById('questionTitle').textContent=`${q.subject||''} / ${q.title||''}`;
  document.getElementById('questionText').textContent=q.question||'';
  document.getElementById('modelAnswerText').textContent=q.answer||'';
  const hintHas = !!(q.hint && q.hint.trim().length);
  document.getElementById('hintText').textContent = q.hint||'';
  document.getElementById('hintButton').style.display = hintHas ? 'inline-block' : 'none';
  document.getElementById('hintBox').style.display='none';

  document.getElementById('userAnswer').value='';

  document.getElementById('modelAnswer').style.display='none';
  document.getElementById('rateArea').classList.add('hidden');
  ['btnPerfect','btnSome','btnNone'].forEach(id=>{
    const b=document.getElementById(id); if(b){ b.classList.remove('selected'); b.disabled=false; }
  });
  const fb=document.getElementById('rateFeedback'); fb.style.display='none'; fb.textContent='保存しました。';
  document.getElementById('nextButton').classList.add('hidden');
  document.getElementById('finishButton').classList.add('hidden');
  document.getElementById('confirmButton').disabled=false;

  const percent = Math.floor((currentIndex)/Math.max(1,currentQuestions.length)*100);
  document.getElementById('progressFill').style.width = percent + '%';
}

function confirmAnswer(){
  document.getElementById('modelAnswer').style.display='block';
  document.getElementById('rateArea').classList.remove('hidden');
  document.getElementById('confirmButton').disabled=true;
  document.getElementById('nextButton').classList.remove('hidden');
  if(currentIndex === currentQuestions.length-1){
    document.getElementById('finishButton').classList.remove('hidden');
  }
  document.getElementById('modelAnswer').scrollIntoView({behavior:'smooth', block:'center'});
}

function rateCurrent(level){
  const q=currentQuestions[currentIndex];
  ['btnPerfect','btnSome','btnNone'].forEach(id=>{ const b=document.getElementById(id); b.classList.remove('selected'); });
  if(level==='perfect'){ document.getElementById('btnPerfect').classList.add('selected'); }
  if(level==='some'){ document.getElementById('btnSome').classList.add('selected'); }
  if(level==='none'){ document.getElementById('btnNone').classList.add('selected'); }
  const fb=document.getElementById('rateFeedback');
  if(level==='some' || level==='none'){ addToReview(q); fb.textContent='復習リストに追加しました。'; }
  else{ fb.textContent='了解。次へ進めます。'; }
  fb.style.display='block';
}

function nextQuestion(){ currentIndex++; renderQuestion(); }

function finishQuiz(){
  if(timerInterval) clearInterval(timerInterval);
  const total = currentQuestions.length;
  let elapsed = 0;
  if(startTime){ elapsed = Math.floor((Date.now()-startTime)/1000); }
  const mm=String(Math.floor(elapsed/60)).padStart(1,'0');
  const ss=String(elapsed%60).padStart(2,'0');

  document.getElementById('totalCount').textContent = total;
  document.getElementById('elapsedTime').textContent = `${mm}:${ss}`;
  document.getElementById('reviewAddedCount').textContent = reviewAddedNow;
  document.getElementById('scoreDisplay').textContent = `${total} 問 完了`;

  show('resultScreen');
}

// ====== ヒント ======
function toggleHint(){
  const box=document.getElementById('hintBox');
  box.style.display = (box.style.display==='none' || box.style.display==='') ? 'block' : 'none';
}

// ====== Utils ======
function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

// ====== サンプル20問（社会：東北1-14／北海道15-20） ======
const SAMPLE_20 = [
  {id:'001',question:'東北地方を日本海側と太平洋側に分けている山脈は何ですか。',answer:'奥羽山脈',hint:'',subject:'社会',point:'東北地方',title:'地形'},
  {id:'002',question:'世界自然遺産に登録された白神山地には、何の木の原生林が広がっていますか。',answer:'ブナ',hint:'',subject:'社会',point:'東北地方',title:'自然・世界遺産'},
  {id:'003',question:'口紅の材料に使われ、古くから最上川の流域で栽培されている工芸作物は何ですか。',answer:'紅花',hint:'',subject:'社会',point:'東北地方',title:'農業・特産'},
  {id:'004',question:'東北地方の三陸沖などにでき、寒流と暖流が交わる場所を何といいますか。',answer:'潮目（潮境）',hint:'',subject:'社会',point:'東北地方',title:'海洋'},
  {id:'005',question:'ホタテガイの養殖がさかんな青森県の湾を何といいますか。',answer:'陸奥湾',hint:'',subject:'社会',point:'東北地方',title:'漁業'},
  {id:'006',question:'東京駅と新青森駅を結ぶ新幹線を何といいますか。',answer:'東北新幹線',hint:'',subject:'社会',point:'東北地方',title:'交通'},
  {id:'007',question:'東京駅から盛岡駅まで、(6)の新幹線と同じ経路を走り、盛岡駅で分岐する新幹線を何といいますか。',answer:'秋田新幹線',hint:'',subject:'社会',point:'東北地方',title:'交通'},
  {id:'008',question:'山形新幹線は東京駅と何駅を結んでいますか。',answer:'新庄駅',hint:'',subject:'社会',point:'東北地方',title:'交通'},
  {id:'009',question:'関東地方と青森県を結ぶ日本最長の高速道路を何といいますか。',answer:'東北自動車道',hint:'',subject:'社会',point:'東北地方',title:'交通'},
  {id:'010',question:'岩手県の松川に、日本で最初につくられた発電所は何という発電方式ですか。',answer:'地熱発電',hint:'',subject:'社会',point:'東北地方',title:'エネルギー'},
  {id:'011',question:'2011年3月11日に発生し、多くの被害をもたらした災害を何といいますか。',answer:'東日本大震災',hint:'',subject:'社会',point:'東北地方',title:'防災'},
  {id:'012',question:'(11)のような地震で起こり、沿岸部に被害をおよぼす高い波のことを何といいますか。',answer:'津波',hint:'',subject:'社会',point:'東北地方',title:'防災'},
  {id:'013',question:'青森県や秋田県などに見られる大きな風車は、何という発電方式のための施設ですか。',answer:'風力発電',hint:'',subject:'社会',point:'東北地方',title:'エネルギー'},
  {id:'014',question:'世界文化遺産に登録された中尊寺金色堂などがあるのは、岩手県のどこの町ですか。',answer:'平泉町',hint:'',subject:'社会',point:'東北地方',title:'歴史'},
  {id:'015',question:'北海道の日本海側は、太平洋側よりも冬の気温が高くなっています。これは沖合いを流れる何という暖流の影響ですか。',answer:'対馬海流',hint:'',subject:'社会',point:'北海道',title:'海流と気候'},
  {id:'016',question:'北海道の観光資源にもなっている流氷が流れ着くのは、日本海側ですか、オホーツク海側ですか。',answer:'オホーツク海側',hint:'',subject:'社会',point:'北海道',title:'自然・気候'},
  {id:'017',question:'稲作に向いていない気候の北海道で栽培するため、「ななつぼし」など寒さに強い稲がつくられました。このことを何といいますか。',answer:'品種改良',hint:'',subject:'社会',point:'北海道',title:'農業'},
  {id:'018',question:'同一の耕地で、1年ごとに数種類の作物を植えかえるやり方を何といいますか。',answer:'輪作',hint:'',subject:'社会',point:'北海道',title:'農業'},
  {id:'019',question:'日本有数の漁港である釧路港が面しているのは、オホーツク海ですか、太平洋ですか。',answer:'太平洋',hint:'',subject:'社会',point:'北海道',title:'漁業'},
  {id:'020',question:'サロマ湖で養殖がさかんな海産物は何ですか。',answer:'ホタテガイ',hint:'',subject:'社会',point:'北海道',title:'養殖'}
];

// ====== 復習モード起動 ======
function startReviewMode(){
  mode='practice';
  const stored = JSON.parse(localStorage.getItem(REVIEW_KEY)||'[]');
  if(!stored || stored.length===0){
    alert('復習リストが空です。練習またはテストで「まだ／ぜんぜん」を付けた問題が追加されます。');
    return;
  }
  currentQuestions = shuffle(stored).slice();
  currentIndex=0; reviewAddedNow=0;
  document.getElementById('timer').textContent='';
  show('quizScreen');
  renderQuestion();
}
</script>
</body>
</html>
